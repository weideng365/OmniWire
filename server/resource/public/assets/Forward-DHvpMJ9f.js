import{f as m}from"./index-DdvxEg8k.js";import{o as ce,A as pe,a as S,c as F,d as e,w as l,r as b,e as i,B as _e,G as me,n as K,b as o,t as u,C as W,y as r,h as c,U as fe,x as ve,I as H,H as j,p as ge,V as be,K as Ve,L as he,s as we,N as ye,W as Ce,i as xe,R as $,S as $e}from"./index-CXM0Czvl.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"forward-page"},ke={class:"card-header"},Se={class:"header-title"},Pe={class:"header-actions"},Ae={class:"refresh-control"},Le={class:"rule-name"},De={key:0,class:"rule-desc"},Ie={class:"port-tag"},Me={class:"target-info"},ze={class:"rate-info"},Fe={class:"rate-item up"},qe={class:"rate-item down"},Ne={class:"conn-count"},Re={class:"current"},Ee={class:"max"},Te={key:0,class:"stats-container"},Ge={class:"stats-header"},Ke={class:"uptime-badge"},We={class:"stats-cards"},He={class:"stat-box primary"},je={class:"stat-icon"},Je={class:"stat-v"},Oe={class:"stat-l"},Qe={class:"stat-box success"},Xe={class:"stat-icon"},Ye={class:"stat-v"},Ze={class:"stat-l"},et={class:"stat-box warning"},tt={class:"stat-icon"},lt={class:"stat-v"},at={class:"stat-l"},nt={__name:"Forward",setup(ot){const D=b(!1),I=b(!1),q=b([]),w=b(!1),M=b(!1),B=b(null),f=b(null),y=b(3e3);let C=null;const s=b({name:"",protocol:"tcp",listenPort:8080,targetAddr:"",targetPort:80,maxConn:1e3,uploadLimit:0,downloadLimit:0,enabled:!0,description:""}),v=async()=>{try{const n=await m.list({page:1,pageSize:100});q.value=n.data?.rules||[]}catch(n){console.error(n)}},J=async()=>{D.value=!0,await v(),D.value=!1},O=async()=>{if(!s.value.name||!s.value.targetAddr){$.warning("请填写完整信息");return}I.value=!0;try{B.value?await m.update(B.value.id,s.value):await m.create(s.value),$.success("保存成功"),w.value=!1,le(),await v()}catch(n){console.error(n)}I.value=!1},Q=n=>{B.value=n,s.value={...n},w.value=!0},X=async n=>{try{await $e.confirm(`确定删除规则 "${n.name}" 吗？`,"确认删除",{type:"warning"}),await m.delete(n.id),$.success("删除成功"),await v()}catch{}},Y=async n=>{try{await m.start(n.id),$.success("规则已启动"),await v()}catch(t){console.error(t)}},Z=async n=>{try{await m.stop(n.id),$.success("规则已停止"),await v()}catch(t){console.error(t)}},ee=async n=>{try{await m.update(n.id,{enabled:n.enabled}),n.enabled?await m.start(n.id):await m.stop(n.id),$.success(n.enabled?"已启用":"已禁用"),await v()}catch{n.enabled=!n.enabled}},te=async n=>{try{const t=await m.stats(n.id);f.value=t.data?.stats||{},M.value=!0}catch(t){console.error(t)}},le=()=>{B.value=null,s.value={name:"",protocol:"tcp",listenPort:8080,targetAddr:"",targetPort:80,maxConn:1e3,uploadLimit:0,downloadLimit:0,enabled:!0,description:""}},N=n=>{if(!n)return"0 B";const t=["B","KB","MB","GB","TB"];let d=0;for(;n>=1024&&d<t.length-1;)n/=1024,d++;return`${n.toFixed(1)} ${t[d]}`},P=n=>{if(!n)return"0 B/s";const t=["B/s","KB/s","MB/s","GB/s"];let d=0;for(;n>=1024&&d<t.length-1;)n/=1024,d++;return`${n.toFixed(0)} ${t[d]}`},ae=n=>{if(!n)return"0秒";const t=Math.floor(n/86400),d=Math.floor(n%86400/3600),p=Math.floor(n%3600/60),U=n%60;return t>0?`${t}天${d}时${p}分`:d>0?`${d}时${p}分${U}秒`:p>0?`${p}分${U}秒`:`${U}秒`},ne=()=>{C&&clearInterval(C),y.value>0&&(v(),C=setInterval(v,y.value))};return ce(()=>{J(),y.value>0&&(C=setInterval(v,y.value))}),pe(()=>{C&&clearInterval(C)}),(n,t)=>{const d=i("el-icon"),p=i("el-option"),U=i("el-select"),h=i("el-button"),g=i("el-table-column"),oe=i("el-tag"),R=i("el-switch"),A=i("el-tooltip"),se=i("el-table"),de=i("el-card"),k=i("el-input"),_=i("el-form-item"),E=i("el-radio-button"),ie=i("el-radio-group"),V=i("el-col"),z=i("el-input-number"),L=i("el-row"),T=i("el-divider"),ue=i("el-form"),G=i("el-dialog"),re=_e("loading");return S(),F("div",Ue,[e(de,{class:"rules-card"},{header:l(()=>[o("div",ke,[o("div",Se,[e(d,null,{default:l(()=>[e(c(we))]),_:1}),t[15]||(t[15]=o("span",null,"转发规则管理",-1))]),o("div",Pe,[o("div",Ae,[t[16]||(t[16]=o("span",null,"自动刷新: ",-1)),e(U,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),onChange:ne,size:"small",style:{width:"100px"}},{default:l(()=>[e(p,{label:"关闭",value:0}),e(p,{label:"1秒",value:1e3}),e(p,{label:"3秒",value:3e3}),e(p,{label:"5秒",value:5e3}),e(p,{label:"10秒",value:1e4})]),_:1},8,["modelValue"])]),e(h,{type:"primary",onClick:t[1]||(t[1]=a=>w.value=!0)},{default:l(()=>[e(d,null,{default:l(()=>[e(c(ye))]),_:1}),t[17]||(t[17]=r(" 添加规则 ",-1))]),_:1})])])]),default:l(()=>[me((S(),K(se,{data:q.value,style:{width:"100%"},"row-style":{height:"64px"}},{default:l(()=>[e(g,{prop:"name",label:"名称","min-width":"140"},{default:l(({row:a})=>[o("span",Le,u(a.name),1),a.description?(S(),F("div",De,u(a.description),1)):W("",!0)]),_:1}),e(g,{label:"协议",width:"100",align:"center"},{default:l(({row:a})=>[e(oe,{type:a.protocol==="tcp"?"primary":"warning",effect:"light",round:""},{default:l(()=>[r(u(a.protocol.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"监听端口",width:"100"},{default:l(({row:a})=>[o("code",Ie,u(a.listenPort),1)]),_:1}),e(g,{label:"转发目标","min-width":"180"},{default:l(({row:a})=>[o("div",Me,[e(d,null,{default:l(()=>[e(c(fe))]),_:1}),o("code",null,u(a.targetAddr)+":"+u(a.targetPort),1)])]),_:1}),e(g,{label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[o("div",{class:ve(["status-badge",{running:a.running}])},[t[18]||(t[18]=o("span",{class:"dot"},null,-1)),r(" "+u(a.running?"运行中":"已停止"),1)],2)]),_:1}),e(g,{label:"实时速率",width:"160"},{default:l(({row:a})=>[o("div",ze,[o("div",Fe,[e(d,null,{default:l(()=>[e(c(H))]),_:1}),o("span",null,u(P(a.uploadSpeed)),1)]),o("div",qe,[e(d,null,{default:l(()=>[e(c(j))]),_:1}),o("span",null,u(P(a.downloadSpeed)),1)])])]),_:1}),e(g,{label:"连接数",width:"100",align:"center"},{default:l(({row:a})=>[o("div",Ne,[o("span",Re,u(a.currentConn||0),1),o("span",Ee,"/"+u(a.maxConn),1)])]),_:1}),e(g,{label:"启用",width:"80",align:"center"},{default:l(({row:a})=>[e(R,{modelValue:a.enabled,"onUpdate:modelValue":x=>a.enabled=x,onChange:x=>ee(a),style:{"--el-switch-on-color":"var(--success)","--el-switch-off-color":"var(--text-muted)"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(g,{label:"操作",width:"180",fixed:"right",align:"center"},{default:l(({row:a})=>[e(A,{content:a.running?"停止":"启动",placement:"top"},{default:l(()=>[e(h,{circle:"",size:"small",type:a.running?"warning":"success",plain:"",onClick:x=>a.running?Z(a):Y(a)},{default:l(()=>[e(d,null,{default:l(()=>[(S(),K(ge(a.running?"VideoPause":"VideoPlay")))]),_:2},1024)]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),e(A,{content:"统计详情",placement:"top"},{default:l(()=>[e(h,{circle:"",size:"small",type:"info",plain:"",onClick:x=>te(a)},{default:l(()=>[e(d,null,{default:l(()=>[e(c(be))]),_:1})]),_:1},8,["onClick"])]),_:2},1024),e(A,{content:"编辑",placement:"top"},{default:l(()=>[e(h,{circle:"",size:"small",onClick:x=>Q(a)},{default:l(()=>[e(d,null,{default:l(()=>[e(c(Ve))]),_:1})]),_:1},8,["onClick"])]),_:2},1024),e(A,{content:"删除",placement:"top"},{default:l(()=>[e(h,{circle:"",size:"small",type:"danger",plain:"",onClick:x=>X(a)},{default:l(()=>[e(d,null,{default:l(()=>[e(c(he))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[re,D.value]])]),_:1}),e(G,{modelValue:w.value,"onUpdate:modelValue":t[13]||(t[13]=a=>w.value=a),title:B.value?"编辑转发规则":"添加转发规则",width:"600px","destroy-on-close":""},{footer:l(()=>[e(h,{onClick:t[12]||(t[12]=a=>w.value=!1)},{default:l(()=>[...t[25]||(t[25]=[r("取消",-1)])]),_:1}),e(h,{type:"primary",onClick:O,loading:I.value},{default:l(()=>[...t[26]||(t[26]=[r("保存配置",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(ue,{model:s.value,"label-width":"100px","label-position":"right"},{default:l(()=>[e(_,{label:"名称",required:""},{default:l(()=>[e(k,{modelValue:s.value.name,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.name=a),placeholder:"给规则起个名字，如：Web Server"},null,8,["modelValue"])]),_:1}),e(L,{gutter:20},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(_,{label:"协议",required:""},{default:l(()=>[e(ie,{modelValue:s.value.protocol,"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.protocol=a)},{default:l(()=>[e(E,{label:"tcp"},{default:l(()=>[...t[19]||(t[19]=[r("TCP",-1)])]),_:1}),e(E,{label:"udp"},{default:l(()=>[...t[20]||(t[20]=[r("UDP",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:l(()=>[e(_,{label:"监听端口",required:""},{default:l(()=>[e(z,{modelValue:s.value.listenPort,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.listenPort=a),min:1,max:65535,style:{width:"100%"},"controls-position":"right",placeholder:"例如: 8080"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{"content-position":"left"},{default:l(()=>[...t[21]||(t[21]=[r("转发目标",-1)])]),_:1}),e(L,{gutter:20},{default:l(()=>[e(V,{span:16},{default:l(()=>[e(_,{label:"目标地址",required:""},{default:l(()=>[e(k,{modelValue:s.value.targetAddr,"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.targetAddr=a),placeholder:"例如: 192.168.1.100"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:8},{default:l(()=>[e(_,{label:"目标端口",required:"","label-width":"70px"},{default:l(()=>[e(z,{modelValue:s.value.targetPort,"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.targetPort=a),min:1,max:65535,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{"content-position":"left"},{default:l(()=>[...t[22]||(t[22]=[r("高级选项",-1)])]),_:1}),e(L,{gutter:20},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(_,{label:"最大连接数"},{default:l(()=>[e(z,{modelValue:s.value.maxConn,"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.maxConn=a),min:1,max:1e4,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:l(()=>[e(_,{label:"立即启用"},{default:l(()=>[e(R,{modelValue:s.value.enabled,"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{gutter:20},{default:l(()=>[e(V,{span:12},{default:l(()=>[e(_,{label:"上传限速"},{default:l(()=>[e(k,{modelValue:s.value.uploadLimit,"onUpdate:modelValue":t[9]||(t[9]=a=>s.value.uploadLimit=a),placeholder:"0 为不限速"},{append:l(()=>[...t[23]||(t[23]=[r("B/s",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:l(()=>[e(_,{label:"下载限速"},{default:l(()=>[e(k,{modelValue:s.value.downloadLimit,"onUpdate:modelValue":t[10]||(t[10]=a=>s.value.downloadLimit=a),placeholder:"0 为不限速"},{append:l(()=>[...t[24]||(t[24]=[r("B/s",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{label:"备注"},{default:l(()=>[e(k,{modelValue:s.value.description,"onUpdate:modelValue":t[11]||(t[11]=a=>s.value.description=a),type:"textarea",rows:"2",placeholder:"可选备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(G,{modelValue:M.value,"onUpdate:modelValue":t[14]||(t[14]=a=>M.value=a),title:"流量统计详情",width:"600px",center:"","destroy-on-close":""},{default:l(()=>[f.value?(S(),F("div",Te,[o("div",Ge,[o("div",Ke,[e(d,null,{default:l(()=>[e(c(Ce))]),_:1}),r(" 已运行: "+u(ae(f.value.uptime)),1)])]),o("div",We,[o("div",He,[o("div",je,[e(d,null,{default:l(()=>[e(c(xe))]),_:1})]),t[27]||(t[27]=o("div",{class:"stat-p"},"当前连接",-1)),o("div",Je,u(f.value.currentConn),1),o("div",Oe,"总连接: "+u(f.value.totalConn),1)]),o("div",Qe,[o("div",Xe,[e(d,null,{default:l(()=>[e(c(j))]),_:1})]),t[28]||(t[28]=o("div",{class:"stat-p"},"接收流量",-1)),o("div",Ye,u(N(f.value.bytesReceived)),1),o("div",Ze,"速率: "+u(P(f.value.downloadSpeed||0)),1)]),o("div",et,[o("div",tt,[e(d,null,{default:l(()=>[e(c(H))]),_:1})]),t[29]||(t[29]=o("div",{class:"stat-p"},"发送流量",-1)),o("div",lt,u(N(f.value.bytesSent)),1),o("div",at,"速率: "+u(P(f.value.uploadSpeed||0)),1)])])])):W("",!0)]),_:1},8,["modelValue"])])}}},ut=Be(nt,[["__scopeId","data-v-d25d3750"]]);export{ut as default};
