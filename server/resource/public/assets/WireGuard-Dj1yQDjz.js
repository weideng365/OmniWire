import{w as v}from"./index-DDJd1yoM.js";import{r as m,o as Ie,k as $e,a as P,c as X,d as l,w as a,e as d,l as De,b as s,m as he,t as _,h as $,j as c,p as Re,q as Y,s as B,v as Z,x as Ae,y as Ke,E as f,z as Se}from"./index-BarsFDka.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"wireguard-page"},Te={class:"status-header"},Le={class:"status-info"},Ne={class:"status-text"},qe={class:"status-actions"},Ge={class:"status-details"},Me={class:"detail-item"},Qe={class:"value"},We={class:"detail-item"},ze={class:"value"},je={class:"detail-item"},Fe={class:"value key"},Oe={class:"detail-item"},He={class:"value"},Je={class:"card-header"},Xe={class:"header-actions"},Ye={class:"traffic"},Ze={class:"qrcode-container"},el=["src"],ll={__name:"WireGuard",setup(al){const i=m(!1),h=m(!1),R=m(!1),b=m({}),q=m([]),U=m(!1),D=m(!1),E=m(!1),V=m(null),T=m(""),A=m(parseInt(localStorage.getItem("wg_refresh_interval")||"5"));let K=null;const g=m({name:"",allowedIPs:""}),n=m({listenPort:51820,address:"",dns:"",mtu:1420,endpointAddress:"",ethDevice:"eth0",persistentKeepalive:25,clientAllowedIPs:"0.0.0.0/0, ::/0",proxyAddress:"",logLevel:"error"}),G=()=>{M(),A.value>0&&(K=setInterval(()=>{h.value||(S(),x())},A.value*1e3))},M=()=>{K&&(clearInterval(K),K=null)},ee=o=>{localStorage.setItem("wg_refresh_interval",o.toString()),G()},x=async()=>{try{const o=await v.status();b.value=o.data||{}}catch(o){console.error(o)}},S=async()=>{h.value=!0;try{const o=await v.peers();q.value=o.data?.peers||[]}catch(o){console.error(o)}h.value=!1},Q=async()=>{try{const o=await v.config();o.data&&(n.value=o.data)}catch(o){console.error(o)}},le=async()=>{i.value=!0;try{await v.start(),f.success("服务已启动"),await x(),await Q()}catch(o){console.error(o)}i.value=!1},ae=async()=>{i.value=!0;try{await v.stop(),f.success("服务已停止"),await x()}catch(o){console.error(o)}i.value=!1},te=async()=>{i.value=!0;try{await v.restart(),f.success("服务已重启"),await x()}catch(o){console.error(o)}i.value=!1},oe=async()=>{if(!g.value.name){f.warning("请输入客户端名称");return}i.value=!0;try{V.value?await v.updatePeer(V.value.id,g.value):await v.createPeer(g.value),f.success(V.value?"保存成功":"添加成功"),U.value=!1,g.value={name:"",allowedIPs:""},V.value=null,await S()}catch(o){console.error(o)}i.value=!1},ne=o=>{V.value=o,g.value={name:o.name,allowedIPs:o.allowedIPs},U.value=!0},se=async o=>{try{await Se.confirm(`确定删除客户端 "${o.name}" 吗？`,"确认删除",{type:"warning"}),await v.deletePeer(o.id),f.success("删除成功"),await S()}catch{}},de=async o=>{try{await v.updatePeer(o.id,{enabled:o.enabled}),f.success(o.enabled?"已启用":"已禁用")}catch{o.enabled=!o.enabled}},ue=async o=>{try{const e=await v.peerQRCode(o.id);T.value=e.data?.qrcode||"",E.value=!0}catch(e){console.error(e)}},ie=async o=>{try{const e=await v.peerConfig(o.id),C=new Blob([e.data?.config||""],{type:"text/plain"}),r=URL.createObjectURL(C),u=document.createElement("a");u.href=r,u.download=`${o.name}.conf`,u.click(),URL.revokeObjectURL(r)}catch(e){console.error(e)}},re=async()=>{if(!n.value.endpointAddress?.trim()){f.warning("请填写公网地址，客户端需要此地址连接服务器");return}i.value=!0;try{await v.updateConfig(n.value),f.success("配置已保存"),D.value=!1,await x()}catch(o){console.error(o)}i.value=!1},pe=o=>o?`${o.slice(0,10)}...${o.slice(-6)}`:"未配置",W=async(o,e)=>{if(!o){f.warning(`${e}为空`);return}try{await navigator.clipboard.writeText(o),f.success(`${e}已复制`)}catch{f.error("复制失败")}},z=o=>{if(!o)return"0 B";const e=["B","KB","MB","GB","TB"];let C=0;for(;o>=1024&&C<e.length-1;)o/=1024,C++;return`${o.toFixed(1)} ${e[C]}`};return Ie(()=>{x(),S(),Q(),G()}),$e(()=>{M()}),(o,e)=>{const C=d("VideoPlay"),r=d("el-icon"),u=d("el-button"),ve=d("VideoPause"),me=d("Refresh"),ce=d("Setting"),fe=d("el-tooltip"),j=d("el-card"),w=d("el-option"),F=d("el-select"),_e=d("Plus"),k=d("el-table-column"),ge=d("el-tag"),ye=d("el-switch"),be=d("Cellphone"),we=d("Download"),Ve=d("Edit"),Ce=d("Delete"),ke=d("el-table"),y=d("el-input"),p=d("el-form-item"),O=d("el-form"),L=d("el-dialog"),H=d("el-divider"),Pe=d("el-button-group"),N=d("el-input-number"),J=d("el-col"),Ue=d("el-row"),xe=De("loading");return P(),X("div",Ee,[l(j,{class:"status-card"},{default:a(()=>[s("div",Te,[s("div",Le,[s("div",{class:he(["status-indicator",{online:b.value.running}])},null,2),s("span",Ne,_(b.value.running?"服务运行中":"服务已停止"),1)]),s("div",qe,[b.value.running?(P(),$(u,{key:1,type:"danger",onClick:ae,loading:i.value},{default:a(()=>[l(r,null,{default:a(()=>[l(ve)]),_:1}),e[26]||(e[26]=c(" 停止 ",-1))]),_:1},8,["loading"])):(P(),$(u,{key:0,type:"success",onClick:le,loading:i.value},{default:a(()=>[l(r,null,{default:a(()=>[l(C)]),_:1}),e[25]||(e[25]=c(" 启动 ",-1))]),_:1},8,["loading"])),l(u,{onClick:te,loading:i.value},{default:a(()=>[l(r,null,{default:a(()=>[l(me)]),_:1}),e[27]||(e[27]=c(" 重启 ",-1))]),_:1},8,["loading"]),l(u,{onClick:e[0]||(e[0]=t=>D.value=!0)},{default:a(()=>[l(r,null,{default:a(()=>[l(ce)]),_:1}),e[28]||(e[28]=c(" 配置 ",-1))]),_:1})])]),s("div",Ge,[s("div",Me,[e[29]||(e[29]=s("span",{class:"label"},"接口",-1)),s("span",Qe,_(b.value.interface||"wg0"),1)]),s("div",We,[e[30]||(e[30]=s("span",{class:"label"},"监听端口",-1)),s("span",ze,_(b.value.listenPort||51820),1)]),s("div",je,[e[31]||(e[31]=s("span",{class:"label"},"公钥",-1)),l(fe,{content:b.value.publicKey,placement:"top"},{default:a(()=>[s("span",Fe,_(pe(b.value.publicKey)),1)]),_:1},8,["content"])]),s("div",Oe,[e[32]||(e[32]=s("span",{class:"label"},"客户端数量",-1)),s("span",He,_(b.value.peerCount||0),1)])])]),_:1}),l(j,null,{header:a(()=>[s("div",Je,[e[34]||(e[34]=s("span",null,"客户端管理",-1)),s("div",Xe,[l(F,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=t=>A.value=t),onChange:ee,size:"small",style:{width:"100px"}},{default:a(()=>[l(w,{value:0,label:"不刷新"}),l(w,{value:3,label:"3秒"}),l(w,{value:5,label:"5秒"}),l(w,{value:10,label:"10秒"}),l(w,{value:30,label:"30秒"})]),_:1},8,["modelValue"]),l(u,{type:"primary",onClick:e[2]||(e[2]=t=>U.value=!0)},{default:a(()=>[l(r,null,{default:a(()=>[l(_e)]),_:1}),e[33]||(e[33]=c(" 添加客户端 ",-1))]),_:1})])])]),default:a(()=>[Re((P(),$(ke,{data:q.value,style:{width:"100%"}},{default:a(()=>[l(k,{prop:"id",label:"ID",width:"60"}),l(k,{prop:"name",label:"名称","min-width":"120"}),l(k,{label:"状态",width:"100"},{default:a(({row:t})=>[l(ge,{type:t.online?"success":"info",size:"small"},{default:a(()=>[c(_(t.online?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),l(k,{label:"IP 地址","min-width":"140"},{default:a(({row:t})=>[s("code",null,_(t.allowedIPs),1)]),_:1}),l(k,{label:"最后握手","min-width":"120"},{default:a(({row:t})=>[c(_(t.latestHandshake||"从未连接"),1)]),_:1}),l(k,{label:"流量","min-width":"150"},{default:a(({row:t})=>[s("span",Ye," ↓ "+_(z(t.transferRx))+" / ↑ "+_(z(t.transferTx)),1)]),_:1}),l(k,{label:"启用",width:"80"},{default:a(({row:t})=>[l(ye,{modelValue:t.enabled,"onUpdate:modelValue":I=>t.enabled=I,onChange:I=>de(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(k,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(u,{link:"",type:"primary",onClick:I=>ue(t)},{default:a(()=>[l(r,null,{default:a(()=>[l(be)]),_:1})]),_:1},8,["onClick"]),l(u,{link:"",type:"primary",onClick:I=>ie(t)},{default:a(()=>[l(r,null,{default:a(()=>[l(we)]),_:1})]),_:1},8,["onClick"]),l(u,{link:"",type:"primary",onClick:I=>ne(t)},{default:a(()=>[l(r,null,{default:a(()=>[l(Ve)]),_:1})]),_:1},8,["onClick"]),l(u,{link:"",type:"danger",onClick:I=>se(t)},{default:a(()=>[l(r,null,{default:a(()=>[l(Ce)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xe,h.value]])]),_:1}),l(L,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=t=>U.value=t),title:V.value?"编辑客户端":"添加客户端",width:"500px"},{footer:a(()=>[l(u,{onClick:e[5]||(e[5]=t=>U.value=!1)},{default:a(()=>[...e[36]||(e[36]=[c("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:oe,loading:i.value},{default:a(()=>[c(_(V.value?"保存":"添加"),1)]),_:1},8,["loading"])]),default:a(()=>[l(O,{model:g.value,"label-width":"100px"},{default:a(()=>[l(p,{label:"名称",required:""},{default:a(()=>[l(y,{modelValue:g.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value.name=t),placeholder:"请输入客户端名称"},null,8,["modelValue"])]),_:1}),V.value?Y("",!0):(P(),$(p,{key:0,label:"IP 地址"},{default:a(()=>[l(y,{modelValue:g.value.allowedIPs,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value.allowedIPs=t),placeholder:"留空自动分配"},null,8,["modelValue"]),e[35]||(e[35]=s("div",{class:"form-tip"},"留空将自动从地址池分配 IP",-1))]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(L,{modelValue:D.value,"onUpdate:modelValue":e[23]||(e[23]=t=>D.value=t),title:"WireGuard 配置",width:"600px"},{footer:a(()=>[l(u,{onClick:e[22]||(e[22]=t=>D.value=!1)},{default:a(()=>[...e[42]||(e[42]=[c("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:re,loading:i.value},{default:a(()=>[...e[43]||(e[43]=[c("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{model:n.value,"label-width":"120px"},{default:a(()=>[l(H,{"content-position":"left"},{default:a(()=>[...e[37]||(e[37]=[c("密钥信息",-1)])]),_:1}),l(p,{label:"公钥"},{default:a(()=>[l(y,{modelValue:n.value.publicKey,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.publicKey=t),readonly:""},{append:a(()=>[l(u,{onClick:e[7]||(e[7]=t=>W(n.value.publicKey,"公钥"))},{default:a(()=>[l(r,null,{default:a(()=>[l(B(Z))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"私钥"},{default:a(()=>[l(y,{modelValue:n.value.privateKey,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.privateKey=t),type:R.value?"text":"password",readonly:""},{append:a(()=>[l(Pe,null,{default:a(()=>[l(u,{onClick:e[9]||(e[9]=t=>R.value=!R.value)},{default:a(()=>[l(r,null,{default:a(()=>[R.value?(P(),$(B(Ke),{key:1})):(P(),$(B(Ae),{key:0}))]),_:1})]),_:1}),l(u,{onClick:e[10]||(e[10]=t=>W(n.value.privateKey,"私钥"))},{default:a(()=>[l(r,null,{default:a(()=>[l(B(Z))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","type"])]),_:1}),l(H,{"content-position":"left"},{default:a(()=>[...e[38]||(e[38]=[c("服务配置",-1)])]),_:1}),l(Ue,{gutter:20},{default:a(()=>[l(J,{span:12},{default:a(()=>[l(p,{label:"监听端口"},{default:a(()=>[l(N,{modelValue:n.value.listenPort,"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.listenPort=t),min:1,max:65535,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(J,{span:12},{default:a(()=>[l(p,{label:"MTU"},{default:a(()=>[l(N,{modelValue:n.value.mtu,"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.mtu=t),min:1280,max:1500,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(p,{label:"公网地址"},{default:a(()=>[l(y,{modelValue:n.value.endpointAddress,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.endpointAddress=t),placeholder:"IP 或域名，客户端连接使用"},null,8,["modelValue"])]),_:1}),l(p,{label:"网卡接口"},{default:a(()=>[l(y,{modelValue:n.value.ethDevice,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.ethDevice=t),placeholder:"如 eth0, 留空自动检测"},null,8,["modelValue"])]),_:1}),l(p,{label:"VPN 网段"},{default:a(()=>[l(y,{modelValue:n.value.address,"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.address=t),placeholder:"10.66.66.1/24"},null,8,["modelValue"])]),_:1}),l(p,{label:"DNS"},{default:a(()=>[l(y,{modelValue:n.value.dns,"onUpdate:modelValue":e[17]||(e[17]=t=>n.value.dns=t),placeholder:"1.1.1.1, 8.8.8.8"},null,8,["modelValue"])]),_:1}),l(p,{label:"客户端路由"},{default:a(()=>[l(y,{modelValue:n.value.clientAllowedIPs,"onUpdate:modelValue":e[18]||(e[18]=t=>n.value.clientAllowedIPs=t),placeholder:"0.0.0.0/0, ::/0"},null,8,["modelValue"]),e[39]||(e[39]=s("div",{class:"form-tip"},"客户端默认转发到服务端的 IP 范围",-1))]),_:1}),l(p,{label:"存活间隔"},{default:a(()=>[l(N,{modelValue:n.value.persistentKeepalive,"onUpdate:modelValue":e[19]||(e[19]=t=>n.value.persistentKeepalive=t),min:0,max:3600},null,8,["modelValue"]),e[40]||(e[40]=s("span",{class:"unit"},"秒",-1))]),_:1}),l(p,{label:"TCP 中转"},{default:a(()=>[l(y,{modelValue:n.value.proxyAddress,"onUpdate:modelValue":e[20]||(e[20]=t=>n.value.proxyAddress=t),placeholder:":50122 (可选)"},null,8,["modelValue"]),e[41]||(e[41]=s("div",{class:"form-tip"},"用于防止 UDP QoS，留空不开启",-1))]),_:1}),l(p,{label:"日志等级"},{default:a(()=>[l(F,{modelValue:n.value.logLevel,"onUpdate:modelValue":e[21]||(e[21]=t=>n.value.logLevel=t)},{default:a(()=>[l(w,{label:"错误 (Error)",value:"error"}),l(w,{label:"警告 (Warning)",value:"warning"}),l(w,{label:"信息 (Info)",value:"info"}),l(w,{label:"调试 (Debug)",value:"debug"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(L,{modelValue:E.value,"onUpdate:modelValue":e[24]||(e[24]=t=>E.value=t),title:"扫描二维码",width:"350px",center:""},{default:a(()=>[s("div",Ze,[T.value?(P(),X("img",{key:0,src:T.value,alt:"QR Code"},null,8,el)):Y("",!0),e[44]||(e[44]=s("p",null,"使用 WireGuard 客户端扫描此二维码",-1))])]),_:1},8,["modelValue"])])}}},sl=Be(ll,[["__scopeId","data-v-2ef9dafa"]]);export{sl as default};
