import{f as p}from"./index-B4JhxhO9.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as me,l as pe,a as B,c as z,d as l,w as a,r as c,e as s,m as ve,q as ce,h as E,j as f,t as u,b as o,s as _e,E as x,A as fe}from"./index-JfatmDp6.js";const ge={class:"forward-page"},Ve={class:"card-header"},be={class:"header-actions"},ye={class:"rate-info"},we={class:"rate-info"},Ce={class:"traffic-info"},ke={key:0,class:"stats-grid"},xe={class:"stat-item"},he={class:"value"},$e={class:"stat-item"},Ue={class:"value"},Be={class:"stat-item"},Pe={class:"value"},Le={class:"stat-item"},De={class:"value"},Ae={class:"stat-item full-width"},Me={class:"value"},Se={__name:"Forward",setup(Ee){const L=c(!1),D=c(!1),I=c([]),b=c(!1),A=c(!1),h=c(null),g=c(null),y=c(3e3);let w=null;const d=c({name:"",protocol:"tcp",listenPort:8080,targetAddr:"",targetPort:80,maxConn:1e3,uploadLimit:0,downloadLimit:0,enabled:!0,description:""}),v=async()=>{try{const n=await p.list({page:1,pageSize:100});I.value=n.data?.rules||[]}catch(n){console.error(n)}},G=async()=>{L.value=!0,await v(),L.value=!1},K=async()=>{if(!d.value.name||!d.value.targetAddr){x.warning("请填写完整信息");return}D.value=!0;try{h.value?await p.update(h.value.id,d.value):await p.create(d.value),x.success("保存成功"),b.value=!1,X(),await v()}catch(n){console.error(n)}D.value=!1},j=n=>{h.value=n,d.value={...n},b.value=!0},H=async n=>{try{await fe.confirm(`确定删除规则 "${n.name}" 吗？`,"确认删除",{type:"warning"}),await p.delete(n.id),x.success("删除成功"),await v()}catch{}},J=async n=>{try{await p.start(n.id),x.success("规则已启动"),await v()}catch(e){console.error(e)}},O=async n=>{try{await p.stop(n.id),x.success("规则已停止"),await v()}catch(e){console.error(e)}},Q=async n=>{try{await p.update(n.id,{enabled:n.enabled}),n.enabled?await p.start(n.id):await p.stop(n.id),x.success(n.enabled?"已启用":"已禁用"),await v()}catch{n.enabled=!n.enabled}},W=async n=>{try{const e=await p.stats(n.id);g.value=e.data?.stats||{},A.value=!0}catch(e){console.error(e)}},X=()=>{h.value=null,d.value={name:"",protocol:"tcp",listenPort:8080,targetAddr:"",targetPort:80,maxConn:1e3,uploadLimit:0,downloadLimit:0,enabled:!0,description:""}},P=n=>{if(!n)return"0 B";const e=["B","KB","MB","GB","TB"];let i=0;for(;n>=1024&&i<e.length-1;)n/=1024,i++;return`${n.toFixed(1)} ${e[i]}`},q=n=>n?M(n):"无限",M=n=>{if(!n)return"0 B/s";const e=["B/s","KB/s","MB/s","GB/s"];let i=0;for(;n>=1024&&i<e.length-1;)n/=1024,i++;return`${n.toFixed(0)} ${e[i]}`},Y=n=>{if(!n)return"0秒";const e=Math.floor(n/86400),i=Math.floor(n%86400/3600),C=Math.floor(n%3600/60),$=n%60;return e>0?`${e}天${i}时${C}分`:i>0?`${i}时${C}分${$}秒`:C>0?`${C}分${$}秒`:`${$}秒`},Z=()=>{w&&clearInterval(w),y.value>0&&(v(),w=setInterval(v,y.value))};return me(()=>{G(),y.value>0&&(w=setInterval(v,y.value))}),pe(()=>{w&&clearInterval(w)}),(n,e)=>{const i=s("el-option"),C=s("el-select"),$=s("Plus"),k=s("el-icon"),_=s("el-button"),r=s("el-table-column"),F=s("el-tag"),N=s("el-switch"),ee=s("VideoPlay"),le=s("VideoPause"),te=s("DataLine"),ae=s("Edit"),ne=s("Delete"),oe=s("el-table"),de=s("el-card"),S=s("el-input"),m=s("el-form-item"),R=s("el-radio"),se=s("el-radio-group"),U=s("el-input-number"),ue=s("el-form"),T=s("el-dialog"),ie=ve("loading");return B(),z("div",ge,[l(de,null,{header:a(()=>[o("div",Ve,[e[16]||(e[16]=o("span",null,"转发规则",-1)),o("div",be,[l(C,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"刷新频率",style:{width:"120px","margin-right":"12px"},onChange:Z},{default:a(()=>[l(i,{label:"暂停刷新",value:0}),l(i,{label:"1秒刷新",value:1e3}),l(i,{label:"3秒刷新",value:3e3}),l(i,{label:"5秒刷新",value:5e3}),l(i,{label:"10秒刷新",value:1e4})]),_:1},8,["modelValue"]),l(_,{type:"primary",onClick:e[1]||(e[1]=t=>b.value=!0)},{default:a(()=>[l(k,null,{default:a(()=>[l($)]),_:1}),e[15]||(e[15]=f(" 添加规则 ",-1))]),_:1})])])]),default:a(()=>[ce((B(),E(oe,{data:I.value,style:{width:"100%"}},{default:a(()=>[l(r,{prop:"name",label:"名称","min-width":"120"}),l(r,{label:"协议",width:"80"},{default:a(({row:t})=>[l(F,{size:"small",type:t.protocol==="tcp"?"primary":"warning"},{default:a(()=>[f(u(t.protocol.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"监听端口",width:"100"},{default:a(({row:t})=>[o("code",null,u(t.listenPort),1)]),_:1}),l(r,{label:"目标地址","min-width":"160"},{default:a(({row:t})=>[o("code",null,u(t.targetAddr)+":"+u(t.targetPort),1)]),_:1}),l(r,{label:"状态",width:"90"},{default:a(({row:t})=>[l(F,{type:t.running?"success":"info",size:"small"},{default:a(()=>[f(u(t.running?"运行中":"已停止"),1)]),_:2},1032,["type"])]),_:1}),l(r,{label:"实时速率",width:"140"},{default:a(({row:t})=>[o("div",ye,[o("span",null,"↑"+u(M(t.uploadSpeed)),1),o("span",null,"↓"+u(M(t.downloadSpeed)),1)])]),_:1}),l(r,{label:"速率限制",width:"140"},{default:a(({row:t})=>[o("div",we,[o("span",null,"↑"+u(q(t.uploadLimit)),1),o("span",null,"↓"+u(q(t.downloadLimit)),1)])]),_:1}),l(r,{label:"历史流量",width:"160"},{default:a(({row:t})=>[o("div",Ce,[o("span",null,"↑"+u(P(t.totalUpload)),1),o("span",null,"↓"+u(P(t.totalDownload)),1)])]),_:1}),l(r,{label:"连接数",width:"100"},{default:a(({row:t})=>[f(u(t.currentConn||0)+" / "+u(t.maxConn),1)]),_:1}),l(r,{label:"启用",width:"70"},{default:a(({row:t})=>[l(N,{modelValue:t.enabled,"onUpdate:modelValue":V=>t.enabled=V,onChange:V=>Q(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(r,{label:"操作",width:"160",fixed:"right"},{default:a(({row:t})=>[t.running?(B(),E(_,{key:1,link:"",type:"warning",onClick:V=>O(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(le)]),_:1})]),_:1},8,["onClick"])):(B(),E(_,{key:0,link:"",type:"primary",onClick:V=>J(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(ee)]),_:1})]),_:1},8,["onClick"])),l(_,{link:"",type:"primary",onClick:V=>W(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(te)]),_:1})]),_:1},8,["onClick"]),l(_,{link:"",type:"primary",onClick:V=>j(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(ae)]),_:1})]),_:1},8,["onClick"]),l(_,{link:"",type:"danger",onClick:V=>H(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(ne)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,L.value]])]),_:1}),l(T,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=t=>b.value=t),title:h.value?"编辑规则":"添加规则",width:"550px"},{footer:a(()=>[l(_,{onClick:e[12]||(e[12]=t=>b.value=!1)},{default:a(()=>[...e[21]||(e[21]=[f("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:K,loading:D.value},{default:a(()=>[...e[22]||(e[22]=[f("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(ue,{model:d.value,"label-width":"100px"},{default:a(()=>[l(m,{label:"名称",required:""},{default:a(()=>[l(S,{modelValue:d.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.name=t),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"协议",required:""},{default:a(()=>[l(se,{modelValue:d.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.protocol=t)},{default:a(()=>[l(R,{value:"tcp"},{default:a(()=>[...e[17]||(e[17]=[f("TCP",-1)])]),_:1}),l(R,{value:"udp"},{default:a(()=>[...e[18]||(e[18]=[f("UDP",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"监听端口",required:""},{default:a(()=>[l(U,{modelValue:d.value.listenPort,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.listenPort=t),min:1,max:65535},null,8,["modelValue"])]),_:1}),l(m,{label:"目标地址",required:""},{default:a(()=>[l(S,{modelValue:d.value.targetAddr,"onUpdate:modelValue":e[5]||(e[5]=t=>d.value.targetAddr=t),placeholder:"192.168.1.100"},null,8,["modelValue"])]),_:1}),l(m,{label:"目标端口",required:""},{default:a(()=>[l(U,{modelValue:d.value.targetPort,"onUpdate:modelValue":e[6]||(e[6]=t=>d.value.targetPort=t),min:1,max:65535},null,8,["modelValue"])]),_:1}),l(m,{label:"最大连接数"},{default:a(()=>[l(U,{modelValue:d.value.maxConn,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value.maxConn=t),min:1,max:1e4},null,8,["modelValue"])]),_:1}),l(m,{label:"上传速率"},{default:a(()=>[l(U,{modelValue:d.value.uploadLimit,"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.uploadLimit=t),min:0,step:1024},null,8,["modelValue"]),e[19]||(e[19]=o("span",{class:"unit"},"bytes/s (0=无限制)",-1))]),_:1}),l(m,{label:"下载速率"},{default:a(()=>[l(U,{modelValue:d.value.downloadLimit,"onUpdate:modelValue":e[9]||(e[9]=t=>d.value.downloadLimit=t),min:0,step:1024},null,8,["modelValue"]),e[20]||(e[20]=o("span",{class:"unit"},"bytes/s (0=无限制)",-1))]),_:1}),l(m,{label:"立即启用"},{default:a(()=>[l(N,{modelValue:d.value.enabled,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.enabled=t)},null,8,["modelValue"])]),_:1}),l(m,{label:"备注"},{default:a(()=>[l(S,{modelValue:d.value.description,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value.description=t),type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(T,{modelValue:A.value,"onUpdate:modelValue":e[14]||(e[14]=t=>A.value=t),title:"转发统计",width:"500px"},{default:a(()=>[g.value?(B(),z("div",ke,[o("div",xe,[e[23]||(e[23]=o("div",{class:"label"},"总连接数",-1)),o("div",he,u(g.value.totalConn),1)]),o("div",$e,[e[24]||(e[24]=o("div",{class:"label"},"当前连接",-1)),o("div",Ue,u(g.value.currentConn),1)]),o("div",Be,[e[25]||(e[25]=o("div",{class:"label"},"接收流量",-1)),o("div",Pe,u(P(g.value.bytesReceived)),1)]),o("div",Le,[e[26]||(e[26]=o("div",{class:"label"},"发送流量",-1)),o("div",De,u(P(g.value.bytesSent)),1)]),o("div",Ae,[e[27]||(e[27]=o("div",{class:"label"},"运行时间",-1)),o("div",Me,u(Y(g.value.uptime)),1)])])):_e("",!0)]),_:1},8,["modelValue"])])}}},Ne=re(Se,[["__scopeId","data-v-0e712dc4"]]);export{Ne as default};
