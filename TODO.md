# OmniWire 待办事项清单 (To-Do List)

## 🚨 已知严重问题 (Known Bugs)
- [ ] **Windows 下 WireGuard 网卡 IP 配置失败 (APIPA 169.254.x.x)**:
  - **现象**: 启动 WireGuard 后，虚拟网卡无法获取配置的静态 IP (e.g. 198.18.30.1)，而是回退到 169.254.x.x。
  - **现状**: 已尝试使用 `netsh` 和 `PowerShell` (New-NetIPAddress) 配合重试机制和 InterfaceIndex，但部分环境仍有此问题。
  - **可能原因**:
    1. **时序竞争**: Wintun 驱动初始化慢，配置命令执行时设备尚未完全就绪。
    2. **DNS/DHCP 冲突**: 系统 DHCP 客户端可能在强制覆盖静态配置。
    3. **PowerShell 环境**: 执行策略限制或模块缺失。
  - **后续排查方向**: 尝试调用 Wintun 的原生 DLL API 配置 IP (LUID 相关)，或者使用 `net` 库直接操作 Windows 网络栈，绕过命令行工具。

## 1. WireGuard 模块
- [ ] **Windows 防火墙自动配置**:
  - 当前未自动添加入站规则，用户需手动放行 UDP 监听端口 (默认 51820)。
  - 目标：启动服务时自动检测并添加 Windows Defender 防火墙规则。
- [ ] **NAT (互联网共享) 管理**:
  - 当前代码会在 PowerShell 中尝试自动创建 NAT 规则 (`New-NetNat`) 以允许客户端上网。
  - 目标：在前端增加“允许客户端上网”的显式开关，并提供更精细的 NAT 策略管理。
- [ ] **Wintun 驱动集成**:
  - 当前依赖外部脚本 `scripts/download_wintun.ps1` 下载。
  - 目标：将 `wintun.dll` 嵌入程序资源或在启动时自动检测并提示安装/下载，提升开箱即用体验。
- [ ] **IP 地址管理优化**:
  - 当前 `allocateIP` 仅简单递增分配 (.2, .3...)。
  - 目标：实现 IP 地址回收机制（当 Peer 删除后释放 IP），并支持可视化 IP 池管理。
- [ ] **IPv6 完整支持**:
  - 当前重点适配 IPv4。
  - 目标：完善 IPv6 的地址分配、路由配置和 NAT 支持（Windows/Linux）。

## 2. 端口转发 (Forward) 模块
- [ ] **速率统计灵敏度优化**:
  - 用户反馈当前速率显示（1秒刷新）可能不够跟手。
  - 目标：后端引入滑动平均算法或缩短采样间隔 (e.g., 500ms)，前端使用 WebSocket 推送代替轮询，实现“实时”跳动效果。
- [ ] **流量限制算法升级**:
  - 当前可能基于统计周期限制。
  - 目标：实现令牌桶 (Token Bucket) 算法，提供更精准、平滑的限速体验。
- [ ] **端口复用与冲突检测**:
  - 目标：在添加规则时自动检测端口冲突（包括被系统其他进程占用的端口）。

## 3. 系统与运维
- [ ] **服务模式 (Daemon)**:
  - 目标：提供一键安装为 Windows Service 或 Linux Systemd 服务的功能，实现开机自启和后台静默运行。
- [ ] **日志管理**:
  - 目标：实现日志文件轮转 (Log Rotaion) 和前端日志实时查看器。
- [ ] **多网卡/多出口支持**:
  - 目标：允许用户选择特定的出口网卡进行流量转发或 VPN 出站。

## 4. UI/UX 体验
- [ ] **状态自愈**:
  - 前端增加与后端的长连接心跳，当后端重启或网络波动时，前端能自动重连并刷新状态，而不是显示过期数据。
- [ ] **移动端适配**:
  - 优化管理面板在手机浏览器上的显示效果。
